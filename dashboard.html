<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma thIAguinho Solu√ß√µes</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #005c97; --secondary-blue: #363795; --accent-color: #00b4d8;
            --background-light: #f0f2f5; --card-background: #ffffff;
            --text-dark: #212529; --text-light: #6c7575;
            --warning-color: #ffc107; --danger-color: #dc3545;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-light); margin: 0; color: var(--text-dark); }
        .header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white; padding: 20px 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;
        }
        .header-left { display: flex; flex-direction: column; align-items: flex-start; }
        .header h1 { 
            font-size: 1.8rem; margin: 0; font-weight: 700; 
            user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; cursor: pointer;
        }
        .header #user-display { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .header a, .header button {
            background: rgba(255,255,255,0.2); border: 1px solid white; color: white;
            padding: 8px 18px; border-radius: 50px; cursor: pointer; font-weight: 600;
            transition: all 0.2s ease; text-decoration: none; font-family: 'Poppins', sans-serif; font-size: 1rem;
        }
        .header a:hover, .header button:hover { background: white; color: var(--primary-blue); }
        .container { padding: 30px; max-width: 1200px; margin: auto; }
        .accordion {
            background-color: var(--card-background); color: var(--primary-blue); cursor: pointer;
            padding: 20px 25px; width: 100%; border: 1px solid #e9ecef; border-radius: 15px;
            text-align: left; outline: none; font-size: 1.6rem; font-weight: 600; transition: all 0.3s ease;
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .accordion:hover, .accordion.active { color: var(--secondary-blue); box-shadow: 0 8px 25px rgba(0, 92, 151, 0.1); }
        .accordion:after {
            content: url("image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 24 24' fill='%2300b4d8'%3E%3Cpath d='M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61-.25-1.17-.59-1.69-.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19-.15-.24-.42-.12-.64l2-3.46c.12-.22.39-.3.61-.22l2.49 1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z'/%3E%3C/svg%3E");
            transition: transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1); transform: rotate(0deg);
        }
        .accordion.active:after { transform: rotate(90deg); }
        .panel { padding: 0; background-color: transparent; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
        .panel-content { padding: 30px 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .card {
            background-color: var(--card-background); border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.07);
            text-decoration: none; color: var(--text-dark); display: flex; flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s; border: 1px solid #e9ecef; overflow: hidden;
        }
        .card:hover { transform: translateY(-8px); box-shadow: 0 12px 30px rgba(0, 92, 151, 0.12); }
        .card-content { padding: 25px; display: flex; flex-direction: column; flex-grow: 1; }
        .card-header { display: flex; align-items: center; margin-bottom: 15px; }
        .card-icon { font-size: 2rem; margin-right: 15px; line-height: 1; }
        .card-title { font-size: 1.25rem; font-weight: 600; }
        .card-description { font-size: 0.95rem; color: var(--text-light); line-height: 1.6; flex-grow: 1; }
        .card-request { background: var(--secondary-blue); color: white; }
        .card-request:hover { box-shadow: 0 12px 30px rgba(54, 55, 149, 0.25); }
        .card-request .card-title { color: white; }
        .card-request .card-description { color: rgba(255,255,255,0.8); }
        .intro-text { text-align: center; font-size: 1.1rem; color: var(--text-light); max-width: 800px; margin: 0 auto 30px auto; }
        
        /* CSS ADICIONADO (V4.0) */
        .hidden { display: none !important; }
        .full-page-message {
            text-align: center;
            padding: 80px 30px;
            max-width: 600px;
            margin: 20px auto;
            background-color: var(--card-background);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .full-page-message h2 {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        .full-page-message p {
            font-size: 1.1rem;
            color: var(--text-light);
            line-height: 1.6;
        }
        #pending-view h2 { color: var(--primary-blue); }
        #rejected-view h2 { color: var(--danger-color); }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1 id="admin-trigger-area">Plataforma thIAguinho Solu√ß√µes</h1>
            <span id="user-display">Carregando...</span>
        </div>
        <div class="header-right">
            <button id="logout-button">Sair</button>
        </div>
    </div>

    <div class="container" id="dashboard-content">
        <p class="intro-text">Bem-vindo ao seu hub de automa√ß√£o de rotinas ( SUA CAIXA DE FERRAMENTAS üß∞ INTERATIVA ). Selecione uma categoria para explorar os facilitoides dispon√≠veis.</p>

        <button class="accordion">Listas de Compras</button>
        <div class="panel"><div class="panel-content"><div class="grid">
            <a class="card" href="listas_de_compras/lista_inteligente/index.html"><div class="card-content"><div class="card-header"><span class="card-icon">üõí</span><h3 class="card-title">Lista Inteligente</h3></div><p class="card-description">Sua lista de compras com calculadora de pre√ßos, relat√≥rios detalhados e gerenciamento de itens.</p></div></a>
            <a class="card" href="listas_de_compras/lista_facil/index.html"><div class="card-content"><div class="card-header"><span class="card-icon">üé®</span><h3 class="card-title">Lista F√°cil</h3></div><p class="card-description">Interface visual com sistema de "arrastar para o carrinho". Simples e ideal para o dia a dia.</p></div></a>
            <a class="card" href="listas_de_compras/lista_rapida/index.html"><div class="card-content"><div class="card-header"><span class="card-icon">‚ö°Ô∏è</span><h3 class="card-title">Lista R√°pida</h3></div><p class="card-description">O essencial: adicione, marque e gere um relat√≥rio de texto simples. Sem complica√ß√µes.</p></div></a>
        </div></div></div>

        <button class="accordion">Formul√°rios Interativos</button>
        <div class="panel"><div class="panel-content"><div class="grid">
            <a class="card" href="formularios_interativos/diario_bordo.html"><div class="card-content"><div class="card-header"><span class="card-icon">üìÖ</span><h3 class="card-title">Di√°rio de Bordo Profissional</h3></div><p class="card-description">Ferramenta de gest√£o di√°ria para l√≠deres, com planejamento, KPIs e an√°lise semanal automatizada.</p></div></a>
            <a class="card" href="formularios_interativos/controle_remedios.html"><div class="card-content"><div class="card-header"><span class="card-icon">üíä</span><h3 class="card-title">Controle de Tratamento</h3></div><p class="card-description">Plano de tratamento pessoal para adicionar medicamentos, definir hor√°rios e acompanhar o progresso di√°rio.</p></div></a>
            <a class="card" href="formularios_interativos/guia_eventos.html"><div class="card-content"><div class="card-header"><span class="card-icon">üé§</span><h3 class="card-title">Guia de Eventos</h3></div><p class="card-description">Guia interativo para festivais, com programa√ß√£o, roteiro personalizado, jogos e ranking de competidores.</p></div></a>
            <a class="card" href="formularios_interativos/guia_k_food.html"><div class="card-content"><div class="card-header"><span class="card-icon">üçú</span><h3 class="card-title">Guia Interativo K-Food</h3></div><p class="card-description">Guia r√°pido de pratos da culin√°ria coreana com descri√ß√£o, detalhes e argumentos de venda para equipes.</p></div></a>
        </div></div></div>
        
        <button class="accordion">Calculadoras</button>
        <div class="panel"><div class="panel-content"><div class="grid">
            <a class="card" href="calculadoras_cientificas/casio_fx991es.html"><div class="card-content"><div class="card-header"><span class="card-icon">üßÆ</span><h3 class="card-title">Casio FX-991ES</h3></div><p class="card-description">Calculadora cient√≠fica avan√ßada com todas as fun√ß√µes essenciais, mem√≥ria e display de 2 linhas.</p></div></a>
            <a class="card" href="calculadoras_cientificas/calculadora_comum.html"><div class="card-content"><div class="card-header"><span class="card-icon">‚ûï</span><h3 class="card-title">Calculadora Comum</h3></div><p class="card-description">Calculadora b√°sica com as 4 opera√ß√µes, porcentagem e mem√≥ria. Ideal para c√°lculos r√°pidos.</p></div></a>
        </div></div></div>
        
        <button class="accordion">Tem alguma ideia ou precisa de algum facilitoide parecido?</button>
        <div class="panel"><div class="panel-content"><div class="grid">
            <a class="card card-request" href="mailto: thiaguinhosolucoesia@gmail.com?subject=Solicita√ß√£o de Novo Facilitoide"><div class="card-content"><div class="card-header"><span class="card-icon">üí°</span><h3 class="card-title">Solicite seu Facilitoide</h3></div><p class="card-description">Tem uma necessidade espec√≠fica? Uma planilha complexa ou um processo repetitivo? Clique aqui e vamos criar uma ferramenta sob medida para voc√™.</p></div></a>
        </div></div></div>
    </div>

    <div id="pending-view" class="full-page-message hidden">
        <h2>‚è≥ Cadastro em An√°lise</h2>
        <p>Sua conta foi criada e est√° aguardando a aprova√ß√£o do administrador. Voc√™ ser√° liberado em breve!</p>
    </div>

    <div id="rejected-view" class="full-page-message hidden">
        <h2>‚ùå Acesso Recusado</h2>
        <p>O seu cadastro n√£o foi aprovado pelo administrador. Entre em contato com a thIAguinho Solu√ß√µes para mais informa√ß√µes.</p>
    </div>

    <script>
        let currentUser = null;
        let isAdmin = false;
        
        const dom = {
            userDisplay: document.getElementById('user-display'),
            dashboardContent: document.getElementById('dashboard-content'),
            pendingView: document.getElementById('pending-view'),
            rejectedView: document.getElementById('rejected-view'),
            logoutButton: document.getElementById('logout-button')
        };

        // ROTEADOR DE AUTENTICA√á√ÉO (V4.0)
        auth.onAuthStateChanged(async (user) => { 
            if (user) {
                currentUser = user;
                dom.userDisplay.textContent = `Logado como: ${user.email}`;

                // 1. O usu√°rio est√° aprovado (existe em /users_public_list)?
                const userRef = database.ref(`users_public_list/${user.uid}`);
                userRef.once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        
                        // 2. O usu√°rio est√° bloqueado?
                        if (userData.isBlocked === true) {
                            showRejectedView(); // Mostra Acesso Recusado (Bloqueado)
                            return;
                        }

                        // 3. O usu√°rio √© admin?
                        isAdmin = userData.role === 'admin';
                        showDashboard(); // APROVADO: Mostra o conte√∫do
                        
                        // Seta o status de "online"
                        const onlineRef = database.ref("users_online/" + user.uid);
                        onlineRef.set({ email: user.email, lastOnline: new Date().toISOString() });
                        onlineRef.onDisconnect().remove();

                    } else {
                        // 4. Se n√£o est√° na lista p√∫blica, checa se est√° pendente
                        database.ref(`pending_approvals/${user.uid}`).once('value', (pendingSnapshot) => {
                            if (pendingSnapshot.exists()) {
                                showPendingView(); // PENdENTE: Mostra tela de "Em An√°lise"
                            } else {
                                showRejectedView(); // RECUSADO: N√£o est√° em nenhuma lista
                            }
                        });
                    }
                });

            } else { 
                // Se n√£o h√° usu√°rio, volta para o index.
                window.location.replace("index.html"); 
            } 
        });

        // Fun√ß√µes de UI
        function showDashboard() {
            dom.dashboardContent.classList.remove('hidden');
            dom.pendingView.classList.add('hidden');
            dom.rejectedView.classList.add('hidden');
            initializeDashboardLogic(); // Inicia os listeners do dashboard
        }

        function showPendingView() {
            dom.dashboardContent.classList.add('hidden');
            dom.pendingView.classList.remove('hidden');
            dom.rejectedView.classList.add('hidden');
        }

        function showRejectedView() {
            dom.dashboardContent.classList.add('hidden');
            dom.pendingView.classList.add('hidden');
            dom.rejectedView.classList.remove('hidden');
        }

        // Logout
        dom.logoutButton.addEventListener('click', () => {
            if (currentUser) {
                database.ref("users_online/" + currentUser.uid).remove();
            }
            auth.signOut().then(() => {
                window.location.replace("index.html");
            });
        });
        
        // L√≥gica do Admin Trigger (V4.0 - Verifica√ß√£o de Role)
        const adminTriggerElement = document.getElementById('admin-trigger-area');
        let pressTimer = null;

        const startPress = (e) => {
            e.preventDefault(); 
            pressTimer = setTimeout(() => {
                if (!isAdmin) { // S√≥ permite se o usu√°rio logado for admin
                    alert('Acesso negado. Apenas administradores.');
                    return;
                }
                const userInput = prompt("Digite o c√≥digo de acesso administrativo:");
                if (userInput === atob(ADMIN_TRIGGER_KEY)) {
                    sessionStorage.setItem('admin_access_token', 'true');
                    alert('Acesso administrativo verificado. Redirecionando...');
                    window.location.href = 'admin.html';
                } else if (userInput !== null) {
                    alert('C√≥digo de acesso inv√°lido.');
                }
            }, 2000);
        };

        const cancelPress = () => {
            clearTimeout(pressTimer);
        };

        adminTriggerElement.addEventListener("mousedown", startPress);
        adminTriggerElement.addEventListener("touchstart", startPress, { passive: true });
        adminTriggerElement.addEventListener("mouseup", cancelPress);
        adminTriggerElement.addEventListener("touchend", cancelPress);
        adminTriggerElement.addEventListener("mouseleave", cancelPress);

        // L√≥gica dos Accordions
        function initializeDashboardLogic() {
            const accordions = document.getElementsByClassName("accordion");
            for (let i = 0; i < accordions.length; i++) {
                accordions[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    let panel = this.nextElementSibling;
                    if (panel.style.maxHeight) {
                        panel.style.maxHeight = null;
                    } else {
                        panel.style.maxHeight = panel.scrollHeight + "px";
                    }
                });
            }
        }
    </script>
</body>
</html>
